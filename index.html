<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2A map card code generator</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            margin-top: 50px;
        }

        #codeOutput {
            width: 100%;
            height: 400px !important; /* 使用 !important 确保样式的应用 */
            margin-top: 15px;
        }
    </style>
    <h3 style="text-align: center;">2A map card code generator (based on athua chart code)</h1>
</head>
<body>
    <div class="container">
        <div class="form-group">
            <label for="inputId">Enter your 2A's Unique ID:</label>
            <input type="text" class="form-control" id="inputId" placeholder="2A ID">
            <small id="status" class="form-text text-muted">Please enter the 8-digit sensor id for 2A and click on <b>Generate Code</b>.</small>
        </div>
        <button id="copyButton" class="btn btn-primary">Copy Code</button>
        <textarea id="codeOutput" class="form-control" placeholder="The lovelace code for your 2a map will appear here..."></textarea>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.9/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Original code with a placeholder
        var originalCode = `type: custom:plotly-graph

title: Human Sensor 2A %macid% Map
refresh_interval: 1
hours_to_show: current_day
config:
  modeBarButtonsToRemove: ['select2d', 'lasso2d', 'toImage']
  displaylogo: false
layout:
  height: 240
  margin:
    l: 50
    r: 20
    t: 20
    b: 55
  showlegend: true
  xaxis:
    dtick: 1000
    gridcolor: RGBA(200,200,200,0.15)
    zerolinecolor: RGBA(200,200,200,0.15)
    type: number
    fixedrange: true
    range:
      - 4000
      - -4000
  yaxis:
    dtick: 1000
    gridcolor: RGBA(200,200,200,0.15)
    zerolinecolor: RGBA(200,200,200,0.15)
    scaleanchor: x
    scaleratio: 1
    fixedrange: true
    range:
      - 7500
      - 0
entities:
  - entity: ''
    name: Target1
    marker:
      size: 12
    line:
      shape: spline
      width: 5
    x:
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target1_x"].state
    'y':
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target1_y"].state
  - entity: ''
    name: Target2
    marker:
      size: 12
    line:
      shape: spline
      width: 5
    x:
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target2_x"].state
    'y':
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target2_y"].state
  - entity: ''
    name: Target3
    marker:
      size: 12
    line:
      shape: spline
      width: 5
    x:
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target3_x"].state
    'y':
      - $ex hass.states["sensor.screek_human_sensor_2a_%macid%_target3_y"].state
  - entity: ''
    name: Zone1
    mode: lines
    fill: toself
    fillcolor: RGBA(20,200,0,0.06)
    line:
      color: RGBA(20,200,0,0.2)
      shape: line
      width: 2
    x:
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_x_begin"].state
    'y':
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone1_y_begin"].state
  - entity: ''
    name: Zone2
    mode: lines
    fill: toself
    fillcolor: RGBA(200,0,255,0.06)
    line:
      color: RGBA(200,0,255,0.2)
      shape: line
      width: 2
    x:
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_x_begin"].state
    'y':
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone2_y_begin"].state
  - entity: ''
    name: Zone3
    mode: lines
    fill: toself
    fillcolor: RGBA(200,120,55,0.06)
    line:
      color: RGBA(200,120,55,0.2)
      shape: line
      width: 2
    x:
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_x_begin"].state
    'y':
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zone3_y_begin"].state
  - entity: ''
    name: ExZone
    mode: lines
    fill: toself
    fillcolor: RGBA(255,0,0,0.15)
    line:
      shape: line
      width: 1
      color: RGBA(255,0,0,0.2)
    x:
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_x_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_x_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_x_begin"].state
    'y':
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_y_end"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_y_begin"].state
      - >-
        $ex
        hass.states["number.screek_human_sensor_2a_%macid%_zout1_y_begin"].state
  - entity: ''
    name: Coverage
    mode: lines
    fill: tonexty
    fillcolor: rgba(168, 216, 234, 0.15)
    line:
      shape: line
      width: 1
      dash: dot
    x:
      - 0
      - $ex 7500 * Math.sin((2 * Math.PI)/360 * 60)
      - 4500
      - 4000
      - 3000
      - 2000
      - 1000
      - 0
      - -1000
      - -2000
      - -3000
      - -4000
      - -4500
      - $ex -7500 * Math.sin((2 * Math.PI)/360 * 60)
      - 0
    'y':
      - 0
      - $ex 7500 * Math.cos((2 * Math.PI)/360 * 60)
      - $ex Math.sqrt( 7500**2 - 4500**2 )
      - $ex Math.sqrt( 7500**2 - 4000**2 )
      - $ex Math.sqrt( 7500**2 - 3000**2 )
      - $ex Math.sqrt( 7500**2 - 2000**2 )
      - $ex Math.sqrt( 7500**2 - 1000**2 )
      - 7500
      - $ex Math.sqrt( 7500**2 - 1000**2 )
      - $ex Math.sqrt( 7500**2 - 2000**2 )
      - $ex Math.sqrt( 7500**2 - 3000**2 )
      - $ex Math.sqrt( 7500**2 - 4000**2 )
      - $ex Math.sqrt( 7500**2 - 4500**2 )
      - $ex 7500 * Math.cos((2 * Math.PI)/360 * 60)
      - 0
raw_plotly_config: true`;

        // 获取输入框元素
        var inputIdElement = document.getElementById("inputId");

        // 获取状态元素
        var statusElement = document.getElementById("status");

        // 添加输入事件监听器
        inputIdElement.addEventListener("input", function() {
            var inputId = inputIdElement.value.trim();
            
            // 检查输入的ID是否为8位
            if (inputId.length !== 8) {
                // 设置警告消息的文本内容和颜色
                statusElement.textContent = "Please enter the 8-digit 2A sensor ID correctly!";
            } else {
                // 清空警告消息和样式
                statusElement.textContent = "The corresponding Card code has been generated :)";
                var modifiedCode = originalCode.replace(/%macid%/g, inputId);
                document.getElementById("codeOutput").value = modifiedCode;
            }
        });

        // 添加点击事件监听器
        document.getElementById("copyButton").addEventListener("click", function() {
            var codeOutput = document.getElementById("codeOutput");
            codeOutput.select(); // 选择文本域中的内容
            document.execCommand("copy"); // 复制选中的文本到剪贴板
            statusElement.textContent = "Code Copied!";
            // alert("Code copied to clipboard!"); // 弹出复制成功的提示
        });

    </script>
</body>
<p style="text-align: center; margin-top: 20px;">
    The code for the charts comes from <a href="https://github.com/athua/ha-utils/blob/12cbb61877e6bc143637d02ff5113f43713a3245/LD2450-map-chart.yaml" target="_blank">athua</a>.
</p>
</html>
